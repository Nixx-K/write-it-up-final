@if (user) {
  <div class="container mt-5 mb-5">
    <div class="row">
      <div class="col-md-4 mb-4">
        <div class="card shadow border-0 text-center">
          <div class="card-body p-4">
            <img [src]="user.avatarUrl" class="rounded-circle mb-3 border p-1" width="150" height="150" alt="Avatar">
            <h2 class="mb-1">{{ user.username }}</h2>
            
            <div class="mb-3 text-warning">
              <span class="fs-4">{{ averageRating | number:'1.1-1' }}</span>
              <i class="bi bi-star-fill ms-1"></i>
              <small class="text-muted d-block">({{ ratings.length }} ocen)</small>
            </div>

            <div class="d-flex justify-content-center gap-4 mb-4">
              <div class="text-center">
                <div class="fw-bold fs-5">{{ followers.length }}</div>
                <small class="text-muted">Obserwujący</small>
              </div>
              <div class="text-center">
                <div class="fw-bold fs-5">{{ following.length }}</div>
                <small class="text-muted">Obserwowani</small>
              </div>
            </div>

            <p class="text-secondary mb-4">{{ user.bio || 'Brak opisu profilu.' }}</p>
            
            <div class="d-grid gap-2" *ngIf="authService.getCurrentUser()?.id !== user.id">
              <button (click)="toggleFollow()" class="btn" [class.publish-btn]="!isFollowing" [class.btn-outline-secondary]="isFollowing">
                {{ isFollowing ? 'Przestań obserwować' : 'Obserwuj' }}
              </button>
            </div>

            <div class="mt-4 pt-4 border-top" *ngIf="authService.getCurrentUser()?.id !== user.id">
              <h6>Oceń autora:</h6>
              <div class="fs-4 text-warning" *ngIf="!hasRated">
                <i (click)="rate(1)" class="bi bi-star cursor-pointer"></i>
                <i (click)="rate(2)" class="bi bi-star cursor-pointer"></i>
                <i (click)="rate(3)" class="bi bi-star cursor-pointer"></i>
                <i (click)="rate(4)" class="bi bi-star cursor-pointer"></i>
                <i (click)="rate(5)" class="bi bi-star cursor-pointer"></i>
              </div>
              <div class="text-success small" *ngIf="hasRated">Dziękujemy za ocenę!</div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <h3 class="mb-4">Dzieła Autora ({{ userStories.length }})</h3>
        <div class="row row-cols-1 g-3">
          @for (story of userStories; track story.id) {
            <div class="col">
              <div class="card shadow-sm border-0">
                <div class="row g-0">
                  <div class="col-md-3">
                    <img [src]="story.coverUrl" class="img-fluid rounded-start h-100" alt="..." style="object-fit: cover;">
                  </div>
                  <div class="col-md-9">
                    <div class="card-body">
                      <div class="d-flex justify-content-between">
                        <h5 class="card-title">{{ story.title }}</h5>
                        <span class="badge bg-light text-dark border">{{ story.genre }}</span>
                      </div>
                      <p class="card-text text-secondary">{{ story.description | slice:0:150 }}...</p>
                      <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                          <i class="bi bi-eye me-1"></i>{{ story.views }} 
                          <i class="bi bi-heart-fill text-danger ms-2 me-1"></i>{{ story.likes }}
                        </small>
                        <a [routerLink]="['/story', story.id]" class="btn publish-btn btn-sm px-4">Czytaj</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          } @empty {
            <div class="text-center py-5 bg-white rounded shadow-sm">
              <p class="text-muted mb-0">Ten autor nie opublikował jeszcze żadnych opowiadań.</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
} @else {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
}
